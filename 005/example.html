<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - geometry - extrude shapes</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #222;
				margin: 0px;
				overflow: hidden;
			}
			a {
				color: #f80;
			}
		</style>
	</head>

	<body>

		<script src="../three.min.js"></script>
		<script src="../src/controls/TrackballControls.js"></script>

		<script>
			var container;
			var camera, scene, renderer, controls;
			var mouse = new THREE.Vector2();
			init();
			animate();
			function init() {
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );
				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0x222222 );
				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.set( 0, 0, 500 );
				controls = new THREE.TrackballControls( camera, renderer.domElement );
				controls.minDistance = 200;
				controls.maxDistance = 500;
				scene.add( new THREE.AmbientLight( 0x222222 ) );
				var light = new THREE.PointLight( 0xffffff );
				light.position.copy( camera.position );
				scene.add( light );

				var randomPoints = [];
				for ( var i = 0; i < 2; i ++ ) {
					randomPoints.push( new THREE.Vector3( 
						( i - 4.5 ), 
						0, 
						0
					) );
				}
				var randomSpline =  new THREE.CatmullRomCurve3( randomPoints );
				//
				var extrudeSettings = {
					steps: 200,
					bevelEnabled: false,
					extrudePath: randomSpline
				};
				var pts = [], numPts = 5;
				for ( var i = 0; i < numPts * 2; i ++ ) {
					var l = i % 2 == 1 ? 10 : 20;
					var a = i / numPts * Math.PI;
					pts.push( new THREE.Vector2 ( Math.cos( a ) * l, Math.sin( a ) * l ) );
				}
				var shape = new THREE.Shape( pts );
				var geometry = new THREE.ExtrudeGeometry( shape, extrudeSettings );
				var material2 = new THREE.MeshLambertMaterial( { color: 0xff8000, wireframe: false } );
				var mesh = new THREE.Mesh( geometry, material2 );
				mesh.rotateY(Math.PI/360 * 90);
				scene.add( mesh );


				document.onmousemove = function(event){
					scene.remove(mesh);
		            var rect = renderer.domElement.getBoundingClientRect();
		            mouse.x = ( ( event.clientX - rect.left ) / rect.width ) * 2 - 1;
		            mouse.y = - ( ( event.clientY - rect.top ) / rect.height ) * 2 + 1;
		            // raycaster.setFromCamera( mouse, camera );
		            //console.log(mouse.x, mouse.y);

		            for ( var i = 0; i < 200; i ++ ) {
						randomPoints.push( new THREE.Vector3( 
							i * Math.abs(mouse.x), 
							0, 
							0
						) );
					}

					randomSpline =  new THREE.CatmullRomCurve3( randomPoints );
					extrudeSettings = {
						steps: 1,
						bevelEnabled: false,
						extrudePath: randomSpline
					};

					geometry = new THREE.ExtrudeGeometry( shape, extrudeSettings );
					mesh = new THREE.Mesh( geometry, material2 );
					mesh.rotateY(Math.PI/360 * 90);
					scene.add( mesh );

					//mesh.geometry.elementsNeedUpdate = true;

		        }

			}
			function animate() {
				requestAnimationFrame( animate );
				controls.update();
				renderer.render( scene, camera );
			}
		</script>

	</body>

</html>